var It=Object.defineProperty;var Ot=(F,P,U)=>P in F?It(F,P,{enumerable:!0,configurable:!0,writable:!0,value:U}):F[P]=U;var K=(F,P,U)=>(Ot(F,typeof P!="symbol"?P+"":P,U),U);(function(){"use strict";var Fe,We,Ne;var F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var U={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:F,function(n){var r,a;if(!((a=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&a.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const u="The message port closed before a response was received.",g=d=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class s extends WeakMap{constructor(b,y=void 0){super(y),this.createItem=b}get(b){return this.has(b)||this.set(b,this.createItem(b)),super.get(b)}}const m=i=>i&&typeof i=="object"&&typeof i.then=="function",c=(i,b)=>(...y)=>{d.runtime.lastError?i.reject(new Error(d.runtime.lastError.message)):b.singleCallbackArg||y.length<=1&&b.singleCallbackArg!==!1?i.resolve(y[0]):i.resolve(y)},f=i=>i==1?"argument":"arguments",A=(i,b)=>function(E,..._){if(_.length<b.minArgs)throw new Error(`Expected at least ${b.minArgs} ${f(b.minArgs)} for ${i}(), got ${_.length}`);if(_.length>b.maxArgs)throw new Error(`Expected at most ${b.maxArgs} ${f(b.maxArgs)} for ${i}(), got ${_.length}`);return new Promise((D,B)=>{if(b.fallbackToNoCallback)try{E[i](..._,c({resolve:D,reject:B},b))}catch(x){console.warn(`${i} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,x),E[i](..._),b.fallbackToNoCallback=!1,b.noCallback=!0,D()}else b.noCallback?(E[i](..._),D()):E[i](..._,c({resolve:D,reject:B},b))})},I=(i,b,y)=>new Proxy(b,{apply(E,_,D){return y.call(_,i,...D)}});let w=Function.call.bind(Object.prototype.hasOwnProperty);const C=(i,b={},y={})=>{let E=Object.create(null),_={has(B,x){return x in i||x in E},get(B,x,j){if(x in E)return E[x];if(!(x in i))return;let O=i[x];if(typeof O=="function")if(typeof b[x]=="function")O=I(i,i[x],b[x]);else if(w(y,x)){let Z=A(x,y[x]);O=I(i,i[x],Z)}else O=O.bind(i);else if(typeof O=="object"&&O!==null&&(w(b,x)||w(y,x)))O=C(O,b[x],y[x]);else if(w(y,"*"))O=C(O,b[x],y["*"]);else return Object.defineProperty(E,x,{configurable:!0,enumerable:!0,get(){return i[x]},set(Z){i[x]=Z}}),O;return E[x]=O,O},set(B,x,j,O){return x in E?E[x]=j:i[x]=j,!0},defineProperty(B,x,j){return Reflect.defineProperty(E,x,j)},deleteProperty(B,x){return Reflect.deleteProperty(E,x)}},D=Object.create(i);return new Proxy(D,_)},k=i=>({addListener(b,y,...E){b.addListener(i.get(y),...E)},hasListener(b,y){return b.hasListener(i.get(y))},removeListener(b,y){b.removeListener(i.get(y))}}),M=new s(i=>typeof i!="function"?i:function(y){const E=C(y,{},{getContent:{minArgs:0,maxArgs:0}});i(E)}),T=new s(i=>typeof i!="function"?i:function(y,E,_){let D=!1,B,x=new Promise(G=>{B=function(z){D=!0,G(z)}}),j;try{j=i(y,E,B)}catch(G){j=Promise.reject(G)}const O=j!==!0&&m(j);if(j!==!0&&!O&&!D)return!1;const Z=G=>{G.then(z=>{_(z)},z=>{let ve;z&&(z instanceof Error||typeof z.message=="string")?ve=z.message:ve="An unexpected error occurred",_({__mozWebExtensionPolyfillReject__:!0,message:ve})}).catch(z=>{console.error("Failed to send onMessage rejected reply",z)})};return Z(O?j:x),!0}),v=({reject:i,resolve:b},y)=>{d.runtime.lastError?d.runtime.lastError.message===u?b():i(new Error(d.runtime.lastError.message)):y&&y.__mozWebExtensionPolyfillReject__?i(new Error(y.message)):b(y)},p=(i,b,y,...E)=>{if(E.length<b.minArgs)throw new Error(`Expected at least ${b.minArgs} ${f(b.minArgs)} for ${i}(), got ${E.length}`);if(E.length>b.maxArgs)throw new Error(`Expected at most ${b.maxArgs} ${f(b.maxArgs)} for ${i}(), got ${E.length}`);return new Promise((_,D)=>{const B=v.bind(null,{resolve:_,reject:D});E.push(B),y.sendMessage(...E)})},l={devtools:{network:{onRequestFinished:k(M)}},runtime:{onMessage:k(T),onMessageExternal:k(T),sendMessage:p.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:p.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},h={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":h},services:{"*":h},websites:{"*":h}},C(d,l,o)};n.exports=g(chrome)}else n.exports=globalThis.browser})})(U);var te=U.exports;const S=P(te);var ne={exports:{}};ne.exports,function(e){var t=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",u={};function g(o,s){if(!u[o]){u[o]={};for(var m=0;m<o.length;m++)u[o][o.charAt(m)]=m}return u[o][s]}var d={compressToBase64:function(o){if(o==null)return"";var s=d._compress(o,6,function(m){return r.charAt(m)});switch(s.length%4){default:case 0:return s;case 1:return s+"===";case 2:return s+"==";case 3:return s+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:d._decompress(o.length,32,function(s){return g(r,o.charAt(s))})},compressToUTF16:function(o){return o==null?"":d._compress(o,15,function(s){return n(s+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:d._decompress(o.length,16384,function(s){return o.charCodeAt(s)-32})},compressToUint8Array:function(o){for(var s=d.compress(o),m=new Uint8Array(s.length*2),c=0,f=s.length;c<f;c++){var A=s.charCodeAt(c);m[c*2]=A>>>8,m[c*2+1]=A%256}return m},decompressFromUint8Array:function(o){if(o==null)return d.decompress(o);for(var s=new Array(o.length/2),m=0,c=s.length;m<c;m++)s[m]=o[m*2]*256+o[m*2+1];var f=[];return s.forEach(function(A){f.push(n(A))}),d.decompress(f.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":d._compress(o,6,function(s){return a.charAt(s)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),d._decompress(o.length,32,function(s){return g(a,o.charAt(s))}))},compress:function(o){return d._compress(o,16,function(s){return n(s)})},_compress:function(o,s,m){if(o==null)return"";var c,f,A={},I={},w="",C="",k="",M=2,T=3,v=2,p=[],l=0,h=0,i;for(i=0;i<o.length;i+=1)if(w=o.charAt(i),Object.prototype.hasOwnProperty.call(A,w)||(A[w]=T++,I[w]=!0),C=k+w,Object.prototype.hasOwnProperty.call(A,C))k=C;else{if(Object.prototype.hasOwnProperty.call(I,k)){if(k.charCodeAt(0)<256){for(c=0;c<v;c++)l=l<<1,h==s-1?(h=0,p.push(m(l)),l=0):h++;for(f=k.charCodeAt(0),c=0;c<8;c++)l=l<<1|f&1,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=f>>1}else{for(f=1,c=0;c<v;c++)l=l<<1|f,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=0;for(f=k.charCodeAt(0),c=0;c<16;c++)l=l<<1|f&1,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=f>>1}M--,M==0&&(M=Math.pow(2,v),v++),delete I[k]}else for(f=A[k],c=0;c<v;c++)l=l<<1|f&1,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=f>>1;M--,M==0&&(M=Math.pow(2,v),v++),A[C]=T++,k=String(w)}if(k!==""){if(Object.prototype.hasOwnProperty.call(I,k)){if(k.charCodeAt(0)<256){for(c=0;c<v;c++)l=l<<1,h==s-1?(h=0,p.push(m(l)),l=0):h++;for(f=k.charCodeAt(0),c=0;c<8;c++)l=l<<1|f&1,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=f>>1}else{for(f=1,c=0;c<v;c++)l=l<<1|f,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=0;for(f=k.charCodeAt(0),c=0;c<16;c++)l=l<<1|f&1,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=f>>1}M--,M==0&&(M=Math.pow(2,v),v++),delete I[k]}else for(f=A[k],c=0;c<v;c++)l=l<<1|f&1,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=f>>1;M--,M==0&&(M=Math.pow(2,v),v++)}for(f=2,c=0;c<v;c++)l=l<<1|f&1,h==s-1?(h=0,p.push(m(l)),l=0):h++,f=f>>1;for(;;)if(l=l<<1,h==s-1){p.push(m(l));break}else h++;return p.join("")},decompress:function(o){return o==null?"":o==""?null:d._decompress(o.length,32768,function(s){return o.charCodeAt(s)})},_decompress:function(o,s,m){var c=[],f=4,A=4,I=3,w="",C=[],k,M,T,v,p,l,h,i={val:m(0),position:s,index:1};for(k=0;k<3;k+=1)c[k]=k;for(T=0,p=Math.pow(2,2),l=1;l!=p;)v=i.val&i.position,i.position>>=1,i.position==0&&(i.position=s,i.val=m(i.index++)),T|=(v>0?1:0)*l,l<<=1;switch(T){case 0:for(T=0,p=Math.pow(2,8),l=1;l!=p;)v=i.val&i.position,i.position>>=1,i.position==0&&(i.position=s,i.val=m(i.index++)),T|=(v>0?1:0)*l,l<<=1;h=n(T);break;case 1:for(T=0,p=Math.pow(2,16),l=1;l!=p;)v=i.val&i.position,i.position>>=1,i.position==0&&(i.position=s,i.val=m(i.index++)),T|=(v>0?1:0)*l,l<<=1;h=n(T);break;case 2:return""}for(c[3]=h,M=h,C.push(h);;){if(i.index>o)return"";for(T=0,p=Math.pow(2,I),l=1;l!=p;)v=i.val&i.position,i.position>>=1,i.position==0&&(i.position=s,i.val=m(i.index++)),T|=(v>0?1:0)*l,l<<=1;switch(h=T){case 0:for(T=0,p=Math.pow(2,8),l=1;l!=p;)v=i.val&i.position,i.position>>=1,i.position==0&&(i.position=s,i.val=m(i.index++)),T|=(v>0?1:0)*l,l<<=1;c[A++]=n(T),h=A-1,f--;break;case 1:for(T=0,p=Math.pow(2,16),l=1;l!=p;)v=i.val&i.position,i.position>>=1,i.position==0&&(i.position=s,i.val=m(i.index++)),T|=(v>0?1:0)*l,l<<=1;c[A++]=n(T),h=A-1,f--;break;case 2:return C.join("")}if(f==0&&(f=Math.pow(2,I),I++),c[h])w=c[h];else if(h===A)w=M+M.charAt(0);else return null;C.push(w),c[A++]=M+w.charAt(0),f--,M=w,f==0&&(f=Math.pow(2,I),I++)}}};return d}();e!=null?e.exports=t:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return t})}(ne);var pe=ne.exports;const se=!!((Fe=S==null?void 0:S.runtime)!=null&&Fe.getBrowserInfo);async function $e(e,t){var n;if((n=e.tabs)!=null&&n.length){e.id=(await S.windows.getCurrent()).id;for(const r of e.tabs)re(r,e.id,t)}}async function we(e,t){var r,a;if(!((r=e.tabs)!=null&&r.length))return;if(!se&&e.state==="normal"){const{width:u,height:g}=((a=(await chrome.system.display.getInfo())[0])==null?void 0:a.bounds)??{width:800,height:600};e.top=e.top??0,e.left=e.left??0,e.height=e.height??g,e.width=e.width??u,e.height>g*2&&(e.height=g),e.width>u*2&&(e.width=u),e.top+e.height<g/2&&(e.top=0),e.top+e.height>g&&(e.top-=e.top+e.height-g),e.left+e.width<u/2&&(e.left=0),e.left+e.width>u&&(e.left-=e.left+e.width-u)}const n=(await S.windows.create({incognito:e.incognito,...e.state!=="normal"?{state:e.state}:{top:e.top,left:e.left,height:e.height,width:e.width}})).id;for(const u of e.tabs)re(u,n,t)}async function qe(e,t,n){for(const r of e.windows){if(t){we(r,n);continue}$e(r,n)}}async function re(e,t,n){var f;const{url:r,title:a,favIconUrl:u,active:g,pinned:d,cookieStoreId:o,isInReaderMode:s,mutedInfo:m,incognito:c}=e;if(r)return(f=S==null?void 0:S.tabs)==null?void 0:f.create({url:se||g||!n?r:`src/discarded/index.html?title=${encodeURIComponent(a)}&url=${encodeURIComponent(r)}&icon=${encodeURIComponent(pe.decompress(u??""))}`,active:g,windowId:t??e.windowId,pinned:d,...se&&{...!g&&n&&{title:a,discarded:!0},openInReaderMode:s,muted:m==null?void 0:m.muted,...!c&&{cookieStoreId:o}}})}const ye=!!((We=S.runtime)!=null&&We.getBrowserInfo),Ze=S.runtime.getURL(""),Ve=["id","title","url","favIconUrl","active","discarded","pinned","incognito","mutedInfo",...ye?["isInReaderMode","cookieStoreId"]:["groupId"]],He={type:"image/webp",quality:.7,max_size:20},Se={autoSave:!1,autoSaveMaxSessions:5,autoSaveTimer:15};function Ge(e,t=""){return`${Ze}src/${e}/index.html${t}`}const ke=(()=>{if(!ye)return;const e=document.createElement("img"),t=document.createElement("canvas").getContext("2d");return{async icon(n,r){return!t||!e||!n||!n.startsWith("data:")?n:new Promise(a=>{e.src=n,e.onload=u=>{if(u.currentTarget instanceof HTMLImageElement){let{max_size:g,quality:d}=r||{max_size:20,quality:.7};(!g||g>=u.currentTarget.naturalWidth)&&(g=u.currentTarget.naturalWidth,d=1),t.canvas.height=g,t.canvas.width=g,t.drawImage(u.currentTarget,0,0,g,g);const o=t.canvas.toDataURL(r==null?void 0:r.type,d);a(n.length>o.length?o:n)}}})}}})();async function Ke(e={}){return Ee({...e,currentWindow:!0})}async function Ee(e={},t){var r;const n=await((r=S==null?void 0:S.tabs)==null?void 0:r.query(e));for(const a of n)if(a.url){a.url.startsWith(Ge("discarded"))&&(a.url=Je(a.url)),a.favIconUrl&&(ke&&(a.favIconUrl=await ke.icon(a.favIconUrl,t)),a.favIconUrl=pe.compress(a.favIconUrl));for(const u in a)Ve.includes(u)||delete a[u]}return n}async function Te(e){var n;const t={title:"Current Session",windows:[],id:"current",dateSaved:void 0,dateModified:void 0,tabsNumber:0};e||(e={}),t.windows=await((n=S==null?void 0:S.windows)==null?void 0:n.getAll());for(const r of t.windows)e.windowId=r.id,r.tabs=await Ee(e,He),t.tabsNumber+=r.tabs.length;return t}function Je(e){const t=new URLSearchParams(new URL(e).search);return decodeURIComponent(t.get("url"))}const ie=(e,t)=>t.some(n=>e instanceof n);let Me,Le;function Qe(){return Me||(Me=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xe(){return Le||(Le=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const oe=new WeakMap,ae=new WeakMap,J=new WeakMap;function Ye(e){const t=new Promise((n,r)=>{const a=()=>{e.removeEventListener("success",u),e.removeEventListener("error",g)},u=()=>{n(W(e.result)),a()},g=()=>{r(e.error),a()};e.addEventListener("success",u),e.addEventListener("error",g)});return J.set(t,e),t}function et(e){if(oe.has(e))return;const t=new Promise((n,r)=>{const a=()=>{e.removeEventListener("complete",u),e.removeEventListener("error",g),e.removeEventListener("abort",g)},u=()=>{n(),a()},g=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",u),e.addEventListener("error",g),e.addEventListener("abort",g)});oe.set(e,t)}let ce={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return oe.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return W(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ce(e){ce=e(ce)}function tt(e){return Xe().includes(e)?function(...t){return e.apply(le(this),t),W(this.request)}:function(...t){return W(e.apply(le(this),t))}}function nt(e){return typeof e=="function"?tt(e):(e instanceof IDBTransaction&&et(e),ie(e,Qe())?new Proxy(e,ce):e)}function W(e){if(e instanceof IDBRequest)return Ye(e);if(ae.has(e))return ae.get(e);const t=nt(e);return t!==e&&(ae.set(e,t),J.set(t,e)),t}const le=e=>J.get(e);function st(e,t,{blocked:n,upgrade:r,blocking:a,terminated:u}={}){const g=indexedDB.open(e,t),d=W(g);return r&&g.addEventListener("upgradeneeded",o=>{r(W(g.result),o.oldVersion,o.newVersion,W(g.transaction),o)}),n&&g.addEventListener("blocked",o=>n(o.oldVersion,o.newVersion,o)),d.then(o=>{u&&o.addEventListener("close",()=>u()),a&&o.addEventListener("versionchange",s=>a(s.oldVersion,s.newVersion,s))}).catch(()=>{}),d}const rt=["get","getKey","getAll","getAllKeys","count"],it=["put","add","delete","clear"],ue=new Map;function Ie(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(ue.get(t))return ue.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,a=it.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||rt.includes(n)))return;const u=async function(g,...d){const o=this.transaction(g,a?"readwrite":"readonly");let s=o.store;return r&&(s=s.index(d.shift())),(await Promise.all([s[n](...d),a&&o.done]))[0]};return ue.set(t,u),u}Ce(e=>({...e,get:(t,n,r)=>Ie(t,n)||e.get(t,n,r),has:(t,n)=>!!Ie(t,n)||e.has(t,n)}));const ot=["continue","continuePrimaryKey","advance"],Oe={},ge=new WeakMap,_e=new WeakMap,at={get(e,t){if(!ot.includes(t))return e[t];let n=Oe[t];return n||(n=Oe[t]=function(...r){ge.set(this,_e.get(this)[t](...r))}),n}};async function*ct(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,at);for(_e.set(n,t),J.set(n,le(t));t;)yield n,t=await(ge.get(n)||t.continue()),ge.delete(n)}function De(e,t){return t===Symbol.asyncIterator&&ie(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&ie(e,[IDBIndex,IDBObjectStore])}Ce(e=>({...e,get(t,n,r){return De(t,n)?ct:e.get(t,n,r)},has(t,n){return De(t,n)||e.has(t,n)}}));var Q={exports:{}};function lt(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}var ut=gt;function gt(e,t,n){var r=n&&n.stringify||lt,a=1;if(typeof e=="object"&&e!==null){var u=t.length+a;if(u===1)return e;var g=new Array(u);g[0]=r(e);for(var d=1;d<u;d++)g[d]=r(t[d]);return g.join(" ")}if(typeof e!="string")return e;var o=t.length;if(o===0)return e;for(var s="",m=1-a,c=-1,f=e&&e.length||0,A=0;A<f;){if(e.charCodeAt(A)===37&&A+1<f){switch(c=c>-1?c:0,e.charCodeAt(A+1)){case 100:case 102:if(m>=o||t[m]==null)break;c<A&&(s+=e.slice(c,A)),s+=Number(t[m]),c=A+2,A++;break;case 105:if(m>=o||t[m]==null)break;c<A&&(s+=e.slice(c,A)),s+=Math.floor(Number(t[m])),c=A+2,A++;break;case 79:case 111:case 106:if(m>=o||t[m]===void 0)break;c<A&&(s+=e.slice(c,A));var I=typeof t[m];if(I==="string"){s+="'"+t[m]+"'",c=A+2,A++;break}if(I==="function"){s+=t[m].name||"<anonymous>",c=A+2,A++;break}s+=r(t[m]),c=A+2,A++;break;case 115:if(m>=o)break;c<A&&(s+=e.slice(c,A)),s+=String(t[m]),c=A+2,A++;break;case 37:c<A&&(s+=e.slice(c,A)),s+="%",c=A+2,A++,m--;break}++m}++A}return c===-1?e:(c<f&&(s+=e.slice(c)),s)}const Be=ut;Q.exports=R;const V=Tt().console||{},mt={mapHttpRequest:ee,mapHttpResponse:ee,wrapRequestSerializer:Ae,wrapResponseSerializer:Ae,wrapErrorSerializer:Ae,req:ee,res:ee,err:Pe,errWithCause:Pe};function X(e,t){return e==="silent"?1/0:t.levels.values[e]}const me=Symbol("pino.logFuncs"),fe=Symbol("pino.hierarchy"),ft={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function je(e,t){const n={logger:t,parent:e[fe]};t[fe]=n}function dt(e,t,n){const r={};t.forEach(a=>{r[a]=n[a]?n[a]:V[a]||V[ft[a]||"log"]||H}),e[me]=r}function At(e,t){return Array.isArray(e)?e.filter(function(r){return r!=="!stdSerializers.err"}):e===!0?Object.keys(t):!1}function R(e){e=e||{},e.browser=e.browser||{};const t=e.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const n=e.browser.write||V;e.browser.write&&(e.browser.asObject=!0);const r=e.serializers||{},a=At(e.browser.serialize,r);let u=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(u=!1);const g=Object.keys(e.customLevels||{}),d=["error","fatal","warn","info","debug","trace"].concat(g);typeof n=="function"&&d.forEach(function(w){n[w]=n}),(e.enabled===!1||e.browser.disabled)&&(e.level="silent");const o=e.level||"info",s=Object.create(n);s.log||(s.log=H),dt(s,d,n),je({},s),Object.defineProperty(s,"levelVal",{get:c}),Object.defineProperty(s,"level",{get:f,set:A});const m={transmit:t,serialize:a,asObject:e.browser.asObject,levels:d,timestamp:St(e)};s.levels=ht(e),s.level=o,s.setMaxListeners=s.getMaxListeners=s.emit=s.addListener=s.on=s.prependListener=s.once=s.prependOnceListener=s.removeListener=s.removeAllListeners=s.listeners=s.listenerCount=s.eventNames=s.write=s.flush=H,s.serializers=r,s._serialize=a,s._stdErrSerialize=u,s.child=I,t&&(s._logEvent=de());function c(){return X(this.level,this)}function f(){return this._level}function A(w){if(w!=="silent"&&!this.levels.values[w])throw Error("unknown level "+w);this._level=w,N(this,m,s,"error"),N(this,m,s,"fatal"),N(this,m,s,"warn"),N(this,m,s,"info"),N(this,m,s,"debug"),N(this,m,s,"trace"),g.forEach(C=>{N(this,m,s,C)})}function I(w,C){if(!w)throw new Error("missing bindings for child Pino");C=C||{},a&&w.serializers&&(C.serializers=w.serializers);const k=C.serializers;if(a&&k){var M=Object.assign({},r,k),T=e.browser.serialize===!0?Object.keys(M):a;delete w.serializers,Y([w],T,M,this._stdErrSerialize)}function v(l){this._childLevel=(l._childLevel|0)+1,this.bindings=w,M&&(this.serializers=M,this._serialize=T),t&&(this._logEvent=de([].concat(l._logEvent.bindings,w)))}v.prototype=this;const p=new v(this);return je(this,p),p.level=this.level,p}return s}function ht(e){const t=e.customLevels||{},n=Object.assign({},R.levels.values,t),r=Object.assign({},R.levels.labels,bt(t));return{values:n,labels:r}}function bt(e){const t={};return Object.keys(e).forEach(function(n){t[e[n]]=n}),t}R.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},R.stdSerializers=mt,R.stdTimeFunctions=Object.assign({},{nullTime:ze,epochTime:Re,unixTime:kt,isoTime:Et});function xt(e){const t=[];e.bindings&&t.push(e.bindings);let n=e[fe];for(;n.parent;)n=n.parent,n.logger.bindings&&t.push(n.logger.bindings);return t.reverse()}function N(e,t,n,r){if(e[r]=X(e.level,n)>X(r,n)?H:n[me][r],!t.transmit&&e[r]===H)return;e[r]=pt(e,t,n,r);const a=xt(e);a.length!==0&&(e[r]=vt(a,e[r]))}function vt(e,t){return function(){return t.apply(this,[...e,...arguments])}}function pt(e,t,n,r){return function(a){return function(){const g=t.timestamp(),d=new Array(arguments.length),o=Object.getPrototypeOf&&Object.getPrototypeOf(this)===V?V:this;for(var s=0;s<d.length;s++)d[s]=arguments[s];if(t.serialize&&!t.asObject&&Y(d,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?a.call(o,wt(this,r,d,g)):a.apply(o,d),t.transmit){const m=t.transmit.level||e._level,c=n.levels.values[m],f=n.levels.values[r];if(f<c)return;yt(this,{ts:g,methodLevel:r,methodValue:f,transmitLevel:m,transmitValue:n.levels.values[t.transmit.level||e._level],send:t.transmit.send,val:X(e._level,n)},d)}}}(e[me][r])}function wt(e,t,n,r){e._serialize&&Y(n,e._serialize,e.serializers,e._stdErrSerialize);const a=n.slice();let u=a[0];const g={};r&&(g.time=r),g.level=e.levels.values[t];let d=(e._childLevel|0)+1;if(d<1&&(d=1),u!==null&&typeof u=="object"){for(;d--&&typeof a[0]=="object";)Object.assign(g,a.shift());u=a.length?Be(a.shift(),a):void 0}else typeof u=="string"&&(u=Be(a.shift(),a));return u!==void 0&&(g.msg=u),g}function Y(e,t,n,r){for(const a in e)if(r&&e[a]instanceof Error)e[a]=R.stdSerializers.err(e[a]);else if(typeof e[a]=="object"&&!Array.isArray(e[a]))for(const u in e[a])t&&t.indexOf(u)>-1&&u in n&&(e[a][u]=n[u](e[a][u]))}function yt(e,t,n){const r=t.send,a=t.ts,u=t.methodLevel,g=t.methodValue,d=t.val,o=e._logEvent.bindings;Y(n,e._serialize||Object.keys(e.serializers),e.serializers,e._stdErrSerialize===void 0?!0:e._stdErrSerialize),e._logEvent.ts=a,e._logEvent.messages=n.filter(function(s){return o.indexOf(s)===-1}),e._logEvent.level.label=u,e._logEvent.level.value=g,r(u,e._logEvent,d),e._logEvent=de(o)}function de(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function Pe(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const n in e)t[n]===void 0&&(t[n]=e[n]);return t}function St(e){return typeof e.timestamp=="function"?e.timestamp:e.timestamp===!1?ze:Re}function ee(){return{}}function Ae(e){return e}function H(){}function ze(){return!1}function Re(){return Date.now()}function kt(){return Math.round(Date.now()/1e3)}function Et(){return new Date(Date.now()).toISOString()}function Tt(){function e(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return e(self)||e(window)||e(this)||{}}}Q.exports.default=R,Q.exports.pino=R;var Mt=Q.exports;const L=P(Mt)({level:"warn"}),q=class q{constructor(){K(this,"db");K(this,"open",!1);K(this,"version",1);return q.instance||(q.instance=this),q.instance}async initDB(){if(this.open){L.debug("[db.initDB[] already open");return}L.info("[db.initDB] init"),this.db=await st("sessions",this.version,{upgrade:this.upgradeSessions}),this.open=!0,this.db.onclose=()=>L.info("[db.initDB] closing db"),this.db.onerror=()=>L.error("[db.initDB] error in db: ",this.db),this.db.onabort=()=>L.error("[db.initDB]: aborted transactions in db: ",this.db)}async loadSessions(t,n){return L.info("[db.loadSessions] init"),await this.initDB(),this.db.getAllFromIndex("sessions","dateSaved",t,n)}async streamSessions(t="dateSaved",n,r,a){L.info("[db.lazyLoadSessions] init");const u=[];await this.initDB();const g=this.db.transaction("sessions").store.index(t),d=await g.count();let o=0;r||(r=d);for await(const s of g.iterate(void 0,a))s.value.windows={length:s.value.windows.length},u.push(s.value),o++,(o===r||u.length===d)&&(o=0,n(u));return d}async loadSessionWindows(t){var n;return L.info("[db.loadSessionWindows] init"),await this.initDB(),(n=await this.db.get("sessions",t))==null?void 0:n.windows}async saveSession(t){return L.info("[db.saveSession] init"),await this.initDB(),this.db.add("sessions",t)}async saveSessions(t){L.info("[db.saveSessions] init"),await this.initDB();const n=this.db.transaction("sessions","readwrite");return new Promise((r,a)=>{for(const u of t)n.store.add(u);n.oncomplete=()=>{L.info("[db.saveSessions] saved batch sessions: ",t),r()},n.onerror=()=>{L.error("[db.saveSessions] error saving sessions: ",t),a()},n.onabort=()=>{L.error("[db.saveSessions] aborted saving sessions: ",t),a()}})}async updateSession(t){return L.info("[db.updateSession] init"),await this.initDB(),this.db.put("sessions",t)}async deleteSession(t){return L.info("[db.deleteSession] init"),await this.initDB(),this.db.delete("sessions",t.id)}async getAutosavedCount(){return L.info("[db.getAutosavedCount] init"),await this.initDB(),this.db.countFromIndex("sessions","tags","Autosave")}async deleteLastAutosavedSession(t=1){L.info("[db.deleteLastAutosavedSession] init"),await this.initDB();const n=this.db.transaction("sessions","readwrite").store.index("dateSaved");for await(const r of n.iterate(null,"next"))if(r.value.tags==="Autosave"&&(r.delete(),t--,!t))break}async deleteSessions(){return L.info("[db.deleteSessions] init"),await this.initDB(),this.db.clear("sessions")}upgradeSessions(t,n,r,a,u){if(L.info(`[db.upgradeSession] init - version: ${r}, old: ${n}`),r===1){L.info("[db.upgradeSession] creating object store");const g=t.createObjectStore("sessions",{keyPath:"id"});g.createIndex("title","title",{unique:!1}),g.createIndex("dateSaved","dateSaved",{unique:!1}),g.createIndex("tags","tags",{unique:!1})}}};K(q,"instance");let he=q;const $=new he;function be(e){const t=Date.now();return{title:e.title,windows:structuredClone(e.windows),tabsNumber:e.tabsNumber,dateSaved:t,dateModified:t,id:crypto.randomUUID(),tags:e.tags}}async function xe(e){return await te.storage.local.get(e)}function Lt(e){return te.storage.local.set(e)}const Ct=(Ne=S==null?void 0:S.runtime)==null?void 0:Ne.sendMessage;async function Ue(){const[e,t]=await Promise.all([xe(Se),S.alarms.get("auto-save")]);e.autoSave&&(typeof t>"u"||t.periodInMinutes!==e.autoSaveTimer)&&S.alarms.create("auto-save",{periodInMinutes:e.autoSaveTimer})}Ue(),S.alarms.onAlarm.addListener(async e=>{if(e.name==="auto-save"){const t=await Te();t.title="Autosave",t.tags="Autosave",await $.saveSession(be(t));const[n,{autoSaveMaxSessions:r,selectionId:a}]=await Promise.all([$.getAutosavedCount(),xe({autoSaveMaxSessions:Se.autoSaveMaxSessions,selectionId:"current"})]);n>r&&$.deleteLastAutosavedSession(n-r),$.streamSessions("dateSaved",u=>{Ct({message:"notifyChangeDB",sessions:u,selectedId:a})})}}),S.runtime.onInstalled.addListener(e=>{e.reason==="update"&&Lt({updated:!0});const t=["page","action"];S.contextMenus.create({id:"save",title:"Save session",contexts:t}),S.contextMenus.create({id:"save-window",title:"Save window",contexts:t})}),S.contextMenus.onClicked.addListener(async({menuItemId:e})=>{var u;const{excludePinned:t,urlFilterList:n}=await xe({excludePinned:!0,urlFilterList:void 0}),r=t?!1:void 0,a=S.i18n.getMessage("labelUnnamedSession");switch(e){case"save":{const g=await Te({pinned:r,url:n});if(!g.tabsNumber)return;g.title=a,$.saveSession(be(g))}break;case"save-window":{const g=await S.windows.getCurrent({populate:!1});if(g.tabs=await Ke({pinned:r,url:n}),!((u=g.tabs)!=null&&u.length))return;const d={title:a,windows:[g],tabsNumber:g.tabs.length};$.saveSession(be(d))}break}}),S.runtime.onMessage.addListener(e=>{switch(e.message){case"openInNewWindow":{we(e.window,e.discarded);break}case"createTab":{re(e.tab,void 0,e.discarded);break}case"openSession":{qe(e.session,!0,e.discarded);break}case"createTimer":{Ue();break}}})})();
